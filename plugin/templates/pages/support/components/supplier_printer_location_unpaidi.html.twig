{% import 'components/form/fields_macros.html.twig' as fields %}
{% import '@iservice/components/fields_macros.html.twig' as fieldsIservice %}

{{ fields.dropdownField(
    'Supplier',
    'suppliers_id',
    partnerId,
    __('Partener'),
    field_options|merge({
        'on_change': "$(this).closest('form').attr('action', window.location.href).submit();",
        'readonly': partnersFieldReadonly
    })
) }}

{% if partnersFieldReadonly %}
    {{ fields.hiddenField(
        'suppliers_id',
        partnerId,
        __('Partener'),
        field_options|merge({
            'no_label': true
        })
    ) }}
{% endif %}

{{ fields.dropdownField(
    'Printer',
    'printer_id',
    printerId,
    printerFieldLabel,
    field_options|merge({
        'condition': {
            'LEFT JOIN': {
                'glpi_infocoms as i': {
                    'ON': {
                        'i': 'items_id',
                        'glpi_printers': 'id'
                    }
                }
            },
            'WHERE': {
                'i.suppliers_id': partnerId,
            }
        },
        'on_change': "$(this).closest('form').attr('action', window.location.href).submit();",
        'readonly': printersFieldReadonly
    })
) }}

{% if printersFieldReadonly %}
    {{ fields.hiddenField(
        'printer_id',
        printerId,
        printerFieldLabel,
        field_options|merge({
            'no_label': true
        })
    ) }}
{% endif %}

{% if usageAddressField %}
    {{ fields.textField(
        'printer[usage_address_field]',
        usageAddressField,
        __('Usage Address', 'iservice'),
        field_options|merge({
            'disabled': true,
        })
    ) }}
{% endif %}

{% if locationName %}
    {{ fields.textField(
        'printer[locationName]',
        locationName,
        __('Location'),
        field_options|merge({
            'disabled': true,
        })
    ) }}
{% endif %}

{% if locationId %}
    {{ fields.textField(
        'locations_id',
        locationId,
        '',
        field_options|merge({
            'type': 'hidden',
        })
    ) }}
{% endif %}

{% if observerVisible %}
    {{ fields.dropdownField(
        'User',
        '_users_id_observer',
        item.fields['_users_id_observer'],
        __('Watcher'),
        field_options|merge({
            'right': 'own_ticket'
        })
    ) }}
{% endif %}

{% if assignedVisible %}
    {{ fields.dropdownField(
        'User',
        '_users_id_assign',
        item.fields['_users_id_assign'],
        __('Assigned to'),
        field_options|merge({
            'right': 'own_ticket'
        })
    ) }}
{% endif %}

{% if sumOfUnpaidInvoicesLink %}
    {{ fieldsIservice.customFormRow(
        __('Sum of unpaid invoices', 'iservice'),
        sumOfUnpaidInvoicesLink,
        {
            'valueClass': 'mt-2'
        }
    ) }}
{% endif %}

{% if lastInvoiceAndCountersTable %}
    {{ fieldsIservice.customFormRow(
        __('Last invoice and counter information', 'iservice'),
        lastInvoiceAndCountersTable
    ) }}
{% endif %}
