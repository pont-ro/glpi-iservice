{% import 'components/form/fields_macros.html.twig' as fields %}
{% import '@iservice/components/fields_macros.html.twig' as fieldsIservice %}
{% set params  = params ?? [] %}
{% set no_header = no_header|default(not item.isNewItem() and not _get._in_modal|default(false)) %}
{% set bg = '' %}
{% if item.isDeleted() %}
   {% set bg = 'asset-deleted' %}
{% endif %}

<div class="asset {{ bg }}">
   {{ include('components/form/header.html.twig', {'in_twig': true}) }}

   {% set rand = random() %}
   {% set params  = params ?? [] %}
   {% set withtemplate = params['withtemplate'] ?? '' %}
   {% set item_type = item.getType() %}
   {% set field_options = {
      'locked_fields': item.getLockedFields(),
   } %}

   <div class="card-body d-flex flex-wrap">
      <div class="col-12 col-xxl-12 flex-column">
         <div class="d-flex flex-row flex-wrap flex-xl-nowrap">
            <div class="row flex-row align-items-start flex-grow-1">
               <div class="row flex-row">
                  {% block form_fields %}
                     {{ fields.textField(
                        'name',
                        item.fields['name'],
                        __('Name'),
                        field_options|merge({'required': true})
                     ) }}

                     {{ fields.dropdownField(
                        'User',
                        'users_id',
                        item.fields['users_id'],
                        __('User'),
                        field_options|merge({
                           'entity': item.fields['entities_id'] ?? -1,
                           'right': 'all'
                        })
                     ) }}

                     {{ fields.textField(
                        'license_plate',
                        item.fields['license_plate'],
                        _t('License Plate'),
                        field_options
                     ) }}

                     {{ fields.textField(
                        'vin',
                        item.fields['vin'],
                        _t('VIN'),
                        field_options
                     ) }}

                     {{ fields.textareaField(
                        'description',
                        item.fields['description'],
                        __('Description'),
                        field_options|merge({'rows': 3})
                     ) }}
                  {% endblock %}
               </div>
            </div>
         </div>
         
         {% if not item.isNewItem() %}
         <div class="form-field row col-12 col-sm-6  mb-2">
            <label class="col-form-label col-xxl-5 text-xxl-end" for="description_646618216">
               {{ _t('Vehicle Expirables') }}
            </label>
            <div class="col-xxl-7  field-container">
               <a href="vehicleexpirable.form.php?vehicle_id={{ item.getID() }}" class="btn btn-primary">
                  <i class="ti ti-plus"></i>
                  {{ _t('Add Expirable') }}
               </a>
               <a href="views.php?view=VehicleExpirables&vehicleexpirables0[vehicle_id]={{ item.getID() }}" class="btn btn-secondary">
                  <i class="ti ti-list"></i>
                  {{ _t('View All Expirables') }}
               </a>
            </div>
         </div>
         {% endif %}
      </div>
   </div>

   {{ include('components/form/buttons.html.twig') }}
</div>
