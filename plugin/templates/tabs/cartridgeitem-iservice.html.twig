<div class="container">
    <div class="center my-3">
        <a class="btn btn-primary me-2" href="#" id="import-button">
            <span onclick="ajaxCall('{{ plugin_url_base }}/ajax/duplicateCartridgeItem.php?cartridgeItemId={{ cartridgeItem.id }}',
                    '{{ _t('Are you sure you want to duplicate this cartridge item?') }}',
                    function(message) {
                        message = JSON.parse(message);
                        if (message.success === true) {
                            window.location.href = '{{ glpi_url_base }}/front/cartridgeitem.form.php?id=' + message.newCartridgeItemId;
                        } else {
                            alert('{{ _t('An error occurred while duplicating cartridge item.') }}');
                        }
                    });
                    ">{{ _t('Duplicate Cartridge Item') }}</span>
        </a>
    </div>

    {% import 'components/form/fields_macros.html.twig' as glpiFields %}
    {% set locale = get_current_locale() %}
    {% set date_selector %}
        <input id="effective-date" name="effective_date" style="width:7.5em" type="text" value="{{ effectiveDate|verbatim_value }}"/>
        <script>
            $(function() {
                $("#effective-date").flatpickr({
                    dateFormat: 'Y-m-d',
                    enableTime: false,
                    weekNumbers: true,
                    time_24hr: true,
                    allowInput: true,
                    clickOpens: true,
                    locale: getFlatPickerLocale("{{ locale['language'] }}", "{{ locale['region'] }}"),
                    onClose(dates, currentdatestring, picker) {
                        picker.setDate(picker.altInput.value, true, picker.config.altFormat)
                    },
                    plugins: [
                        CustomFlatpickrButtons()
                    ]
                });
            });
        </script>
    {% endset %}
    <form method="post" action="{{ plugin_url_base }}/front/cartridgeitem_printermodels.form.php">
        <div class="row my-3">
            <div class="col-12">
                <h3>{{ _t('Compatible printer models') }}</h3>
            </div>
            <div class="col-12 d-flex align-items-center justify-content-start gap-3">
                {{ _t('Show models with tickets newer than') }}
                {{ date_selector }}
                <a class="vsubmit ti ti-refresh" id="refresh-all-printers" href="javascript:void();" onclick="ajaxCall('{{ plugin_url_base }}/ajax/manageItem.php?itemtype=PluginIserviceCartridgeItem&operation=getAllPrinterModels&id={{ cartridgeItem.id }}&ticket_newer_than=' + $('#effective-date').val(), '', function (message) {$('#all-printer-models').html(message);});"></a>
            </div>
        </div>

        <div id="all-printer-models" class="row">
            <i class="fas fa-spinner fa-pulse"></i> Loading, please wait...
        </div>

        <div class="row center my-3">
            <div class="col-12">
                <input type="hidden" name="cartridgeitems_id" value="{{ cartridgeItem.id }}" />
                <input type="hidden" name="_glpi_csrf_token" value="{{ csrf_token() }}" />
                <button type="submit" class="btn btn-primary">{{ _t('Save') }}</button>
            </div>
        </div>

        <script>$('#refresh-all-printers').click();</script>
    </form>
</div>
